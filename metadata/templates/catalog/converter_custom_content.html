<!-- converter_custom_content.html -->

<div class="container">
  <table class="table table-sm">
    {% csrf_token %}
    <h4>Fill the forms to equalize data:</h4>
    <br class="clear">
    <tbody>
      <tr>
        <th>
          <label for="convertForm">Owner:</label>
        </th>
        <td>
          <input type="text" class="form-control" id="owner" name="owner" required="True">
        </td>
      </tr>
      <tr>
        <th>
          <label for="exampleFormControlInput1">Owner email:</label>
        </th>
        <td>  
          <input type="email" class="form-control" id="owner_email" name="owner_email" required="True">
        </td>
      </tr>
      <tr>
        <th>
          <label for="convertForm">Environment:</label>
        </th>
        <td>
          <input type="text" class="form-control" id="environment" name="environment" required="True">
        </td>
      </tr>
      <tr>
        <th>
          <label for="convertForm">Perimeter</label>
        </th>
        <td>
          <select id="perimeter" name="perimeter" class="form-control">
            <option selected>External</option>
            <option>Internal</option>
           </select>
        </td>
      </tr>
      <tr>
        <th>
          <label for="convertForm">Technology:</label>
        </th>
        <td>
          <input type="text" class="form-control" id="technology" name="technology" required="True">
        </td>
      </tr>
      <tr>
        <th>
          <label for="convertForm">System type:</label>
        </th>
        <td>
          <input type="text" class="form-control" id="system_type" name="system_type" required="True">
        </td>
      </tr>
      <tr>
        <th>
          <label for="convertForm">Status:</label>
        </th>
        <td>
          <select id="status" name="status" class="form-control">
            <option>Mitigated</option>
            <option selected>Not identified</option>
            <option>Notified</option>
            <option>Risk accepted</option>
            <option>Solved</option>
          </select>
        </td>
      </tr>
      <tr>
        <th>
          <label for="convertForm">Identification date:</label>
        </th>
        <td>
          <input type="date" class="form-control" id="identification_date" name="identification_date" required="True">
        </td>
      </tr>
      <tr>
        <th>
          <label for="convertForm">Remmediation deadline:</label>
        </th>
        <td>
          <input type="date" class="form-control" id="remmediation_deadline" name="remmediation_deadline" required="True">
        </td>
      </tr>
      <tr>
        <th>
          <label for="convertForm">Reporter:</label>
        </th>
        <td>
          <select id="reporter" name="reporter" class="form-control">
            <option selected>OpenVAS (any)</option>
            <option>Nessus (7.1)</option>
            <option>Custom CSV file (.csv)</option>
         </select>
        </td>
      </tr>
    </tbody>
  </table>

  <br class="clear">
  <div class="form-group">
    <label for="convertForm">Upload a CSV file:</label>
    <input type="file" accept=".csv" class="form-control-file" id="uploadedFile" name="uploadedFile" required="True">      
  </div>
    <label>Ommit dupplicated </label>           
    <input type="checkbox" id="ommit_dupplicated" name="ommit_dupplicated" value="True">
    <br class="clear">
    <br class="clear">
    <button type="submit" class="btn btn-primary" onclick="convert()">Convert</button>
  </div>
</div>
     
<br class="clear">
<br class="clear">

<script>
  function convert() {

    var input_file = document.getElementById('uploadedFile').files[0];
    var ommit_dupplicated = document.getElementById('ommit_dupplicated').value;
  
    var form_fields = [
      'owner',
      'owner_email',
      'environment',
      'technology',
      'system_type',
      'status',
      'identification_date',
      'remmediation_deadline',
      'reporter'
      ];

    var vulnerability = {
      "model": "catalog.vulnerability",
      "fields": {
      "system": null,
      "owner": null,
      "owner_email": null,
      "environment": null,
      "perimeter": null,
      "technology": null,
      "system_type": null,
      "status": null,
      "vulnerability": null,
      "category": null,
      "synopsis": null,
      "cvss_value": null,
      "identification_date": null,
      "reporter": null,
      "risk": null,
      "observation": null,
      "remediation": null,
      "risk_acceptance_reason": "",
      "remediation_deadline": null,
      "report_file": input_file.name,
      "report_page": 0
      }
    };

    for (let i=0; i<form_fields.length; i++) {
      let field = form_fields[i];
      let input_value = document.getElementById(field).value;
      if (input_value == null || input_value == '') {
        return 1
      }
    }
    
    console.log(input_file)
    console.log(ommit_dupplicated)
    console.log(vulnerability)
  } 
</script>
<!-- converter_custom_content.html -->